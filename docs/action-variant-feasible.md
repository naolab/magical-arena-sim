# 実装可能なアクションバリアント案

現状のv2システムで実装可能、または追加要素が少ないバリアント候補

## 実装難易度の定義

- [ ] **🟢 容易**: 既存システムのみで実装可能
- [ ] **🟡 普通**: 小規模な機能追加が必要（1-2機能）
- [ ] **🔴 難しい**: 大規模なシステム追加が必要

---

## 🟥 Rage（激怒）系

### 🟢 既存システムで実装可能

#### HP依存ダメージ系
- [x] **HP減るほど火力上がる** ✅ 実装済み (Bloody Berserk)
  - 計算式: 基本ダメージ × (2 - 現在HP率)
  - 実装: turnProcessorでHP割合による倍率を付与

- [ ] **HP高いほど火力UP**
  - 計算式: 基本ダメージ × 現在HP率
  - 実装: damageCalculation.tsに条件追加

#### 自傷系
- [ ] **高火力だが自分もダメージを喰らう**
  - 実装: ダメージ計算後に自分にもダメージ適用
  - 例: 与ダメージの30%を自分も受ける

- [x] **HP減らして超火力**
  - 実装: 発動時に自分のHPを消費、ダメージ大幅UP
  - 例: 最大HPの20%消費して2.5倍ダメージ

#### 遅延・時限系
- [ ] **2ターン後に大ダメージ**
  - 実装: 特殊効果として「時限爆弾」を追加、2ターン後に発動
  - 既存のduration機能を流用可能

- [ ] **経過ターンに応じてダメージ**
  - 計算式: 基本ダメージ × (1 + ターン数 × 0.1)
  - 実装: BattleState.currentTurnを参照

#### その他
- [x] **割合ダメージ** ✅ 実装済み (Rage percentage)
  - 計算式: 敵の最大HP × 割合（例: 15%）
  - 実装: ダメージ計算に敵maxHp参照を追加

- [x] **ダメージランダム** ✅ 実装済み (Chaos Strike)
  - 計算式: 基本ダメージ × (0.5~2.0のランダム)
  - 実装: turnProcessorで乱数倍率を掛ける

- [x] **かかってるデバフの数に応じてダメージ**
  - 計算式: 基本ダメージ × (1 + デバフ数 × 0.3)
  - 実装: enemyState.activeEffectsからデバフをカウント

- [ ] **使用するたび効果アップ**
  - 実装: 使用回数カウンターをBattleStateに追加
  - 計算式: 基本ダメージ × (1 + 使用回数 × 0.2)

### 🟡 小規模追加で実装可能

- [ ] **一定確率で大ダメージ（クリティカル）**
  - 追加要素: クリティカル判定機能
  - 例: 30%の確率で2倍ダメージ

- [ ] **ファンゲージ消費大ダメージ**
  - 追加要素: ファン率を消費する機能
  - 例: ファン率20%消費して3倍ダメージ

- [ ] **次の攻撃のダメージアップ**
  - 追加要素: 「次回ダメージUP」バフ効果タイプ
  - 1ターンのみ有効なバフ

- [ ] **被ダメUP高火力**
  - 実装: 自分に被ダメUPデバフ + 高火力攻撃
  - 複合効果として実装

### 🟥🟨🟩🟦 全属性共通

- [ ] **コメント全消費する代わりに高性能** 🟡
  - 追加要素: コメント全消費機能
  - ダメージ = 基本 × (1 + コメント数 × 0.5)

---

## 🟩 Terror（恐怖）系

### 🟢 既存システムで実装可能

#### デバフ系
- [ ] **防御力down（被ダメUP）**
  - 実装: 既存のdebuff effectを被ダメージ倍率に適用
  - 効果: 被ダメージ+30% (2ターン)

- [ ] **相手の被ダメUP**
  - 上記と同じ実装

- [ ] **ランダムでデバフ**
  - 実装: 複数のデバフ候補からランダム選択
  - 例: 攻撃DOWN/防御DOWN/ファン増加DOWNのいずれか
- [x] **敵味方ランダム5デバフばら撒き** ✅ 実装済み (Terror chaotic_plague)
  - 実装: 敵味方あわせて5回、毒/呪い/攻撃力低下のいずれかをランダムターゲットに付与
  - 既存の毒・呪い・攻撃力低下エフェクトを再利用

#### 持続ダメージ系
- [x] **毒** ✅ 実装済み (Terror poison)
  - 実装: 新しい効果タイプ「poison」を追加
  - 毎ターン終了時に固定ダメージ（例: 50ダメージ × 3ターン）

- [x] **毎ターン最大HPの固定ダメージ（低倍率）**
  - 実装: 毒の亜種、割合ダメージ版
  - 毎ターン 敵最大HP × 5% のダメージ

#### ファンシステム系
- [ ] **ファン率反転**
  - 実装: プレイヤーとエネミーのfanRateを入れ替え
  - audienceCompositionも反転

#### その他
- [ ] **使用するたび効果アップ**
  - 実装: 使用回数カウンター
  - デバフ強度 = 基本値 × (1 + 使用回数 × 0.2)

### 🟡 小規模追加で実装可能

- [ ] **一定ターン相手のファン増加を止める**
  - 追加要素: 「ファン増加無効」フラグ
  - ターン処理時にフラグチェック

- [ ] **ファンゲージリセット**
  - 実装: 敵のfanRateを初期値に戻す

- [ ] **相手の追加効果の発動を妨害**
  - 追加要素: 「効果無効化」フラグ
  - 特殊効果発動前にフラグチェック

- [ ] **両者持続ダメを喰らうフィールドを生成**
  - 追加要素: フィールド効果システム（簡易版）
  - 毎ターン両者に固定ダメージ

---

## 🟦 Grief（悲嘆）系

### 🟢 既存システムで実装可能

#### 回復系
- [x] **HP低いほど回復量UP** ✅ 実装済み (Grief desperate)
  - 計算式: 基本回復量 × (2 - 現在HP率)
  - HP50%以下で回復量1.5倍、HP0%で2倍

- [x] **割合回復** 
  - 計算式: 最大HP × 割合（例: 30%）
  - 固定量ではなく最大HP基準

- [ ] **50%で全回復、50%でHP半減**
  - 実装: Math.random()で確率分岐
  - ギャンブル性のある回復技

#### 複合効果系
- [x] **回復＋デバフ回避**
  - 実装: 回復 + 自分のデバフを全解除
  - activeEffectsからdebuffタイプを削除

- [ ] **回復＋攻撃UP**
  - 実装: 回復 + バフ付与
  - 複合効果

- [ ] **大回復するが、自分に毒付与**
  - 実装: 大回復 + 自分にpoison効果
  - リスク・リターン型

- [ ] **自傷&3ターンダメージ半減**
  - 実装: 自傷ダメージ + 被ダメージ軽減バフ
  - 新バフタイプ「damage_reduction」追加

#### 持続回復系
- [x] **リジェネ**
  - 実装: 新効果タイプ「regen」追加
  - 毎ターン終了時に固定回復（例: 100HP × 3ターン）

#### その他
- [ ] **1ターン前のHPにする**
  - 実装: BattleStateにHP履歴を追加（直前1ターン分のみ）
  - 履歴からHPを復元

- [ ] **使用するたび効果アップ**
  - 実装: 使用回数カウンター
  - 回復量 = 基本値 × (1 + 使用回数 × 0.2)

### 🟡 小規模追加で実装可能

- [ ] **次のターン食らったダメージの半分を回復**
  - 追加要素: 「被ダメージ記録」機能
  - 次ターン開始時に回復処理

- [ ] **被ダメ軽減**
  - 追加要素: ダメージ計算に軽減率を追加
  - バフタイプ「damage_reduction」で実装

- [ ] **最大HP増加**
  - 実装: maxHpを直接増加
  - 例: 最大HP +200 (永続or期間限定)

- [ ] **敵のHPと交換**
  - 実装: 双方のHPを入れ替え
  - 逆転技として強力

- [ ] **全回復するが3ターン後に死ぬ**
  - 追加要素: 時限死効果「doom」
  - durationが0になったら即死

- [ ] **最大HP減、被ダメ上限設定**
  - 追加要素: ダメージキャップ機能
  - 例: 最大HP -30%、1回の被ダメ上限200

---

## 🟨 Ecstasy（恍惚）系

### 🟢 既存システムで実装可能

#### 自傷バフ系
- [ ] **HP減らして攻撃力UP**
  - 実装: 自傷ダメージ + 攻撃バフ
  - 例: 最大HP 15%消費、攻撃力+50% (3ターン)

- [ ] **防御下げて攻撃上げ**
  - 実装: 自分に被ダメUPデバフ + 攻撃バフ
  - リスク・リターン型

#### 永続・長期バフ系
- [ ] **永続バフ**
  - 実装: duration = 999 などの長期設定
  - 例: 攻撃力+15% (永続)

- [ ] **3ターン火力アップ。4ターン目行動不能**
  - 実装: 強力バフ(3ターン) + スタン効果(1ターン)をキューに追加

#### コメントシステム系
- [x] **コメントの色変換** ✅ 実装済み (Ecstasy convert)
  - 実装: コメントプール内の先頭3個をEcstasyに変換
  - 攻撃なし、変換効果のみ

- [x] **コメント2色陣** ✅ 実装済み (Ecstasy dual_refresh)
  - 実装: コメントプールをリフレッシュし、2属性のみで再配置
  - emotionWeightsではなく既存コメントを直接変換

- [x] **コメントリフレッシュ**
  - 実装: コメント全削除 + ランダム再生成
- [x] **スパチャ出現率ブースト** ✅ 実装済み (Ecstasy superchat_boost)
  - 実装: 3ターンの間、コメント生成時のスパチャ確率を2倍（重ね掛け不可・上書きのみ）
  - 効果中はコメントプール生成処理で確率補正
- [x] **次ターン攻撃力+80%** ✅ 実装済み (Ecstasy attack_charge)
  - 実装: 使用ターンの終了時に次ターンの攻撃力倍率を1.8倍に設定（重ね掛け不可・上書きのみ）
  - ダメージ計算時に専用倍率を消費して一度だけ適用
- [x] **次ターン与ダメージ+50%** ✅ 実装済み (Ecstasy damage_resonance)
  - 実装: 次ターンの通常攻撃・追加ダメージ・毒/呪いなどすべての与ダメージを1.5倍
  - 毒/呪いなどターン開始時のダメージ計算でも倍率を適用し、重ね掛け不可

- [ ] **次のターンの追加コメントを増やす**
  - 実装: 次ターンのみcommentsPerTurnを増加
  - 例: 次ターンのみ+3個

#### その他
- [ ] **かかってるバフが多いほど強化**
  - 計算式: バフ効果 × (1 + バフ数 × 0.1)
  - activeEffectsからバフをカウント

- [ ] **使用するたび効果アップ**
  - 実装: 使用回数カウンター
  - バフ強度 = 基本値 × (1 + 使用回数 × 0.15)

### 🟡 小規模追加で実装可能

- [ ] **コメント強化**
  - 追加要素: コメント補正値を一時的にUP
  - 例: 3ターンの間、commentBonusPerCount × 1.5

- [x] **コメント追加量アップ（永続）**
  - 実装: commentsPerTurnを永続的に増加
  - 例: +1個（永続）

- [ ] **コメント上限解放**
  - 実装: maxCommentPoolSizeを増加
  - 例: 10 → 15

- [ ] **コメント予知**
  - 追加要素: 次に生成されるコメントを事前表示
  - UI要素のみの追加

- [ ] **1ターン行動不能の強力バフ**
  - 追加要素: スタン（行動不能）効果
  - 強力バフ付与 + 次ターンスキップ

- [ ] **相手に小バフ、自分に大バフ**
  - 実装: 敵に弱いバフ、自分に強いバフ
  - バフ上限がある場合の妨害技として機能

---

## 🟥🟨🟩🟦 全属性共通バリアント

### 🟢 既存システムで実装可能

- [ ] **使用するたび効果アップ**
  - 実装: BattleStateに各バリアントの使用回数を記録
  - 効果量 = 基本値 × (1 + 使用回数 × 係数)

### 🟡 小規模追加で実装可能

- [ ] **コメント全消費する代わりに高性能**
  - 追加要素: コメント全消費機能
  - 効果量 = 基本値 × (1 + コメント数 × 係数)

---

## 実装の優先順位案

### フェーズ1: 最小追加で実装可能（🟢のみ）
各属性2-3個ずつ、計10-12個のバリアントを実装

- Rage: HP依存ダメージ、自傷系
- Terror: デバフ系、毒
- Grief: 回復バリエーション、リジェネ
- Ecstasy: コメント色変換、自傷バフ

### フェーズ2: 小規模機能追加（🟡を含む）
クリティカル、時限効果、ファン消費などを追加

- 各属性3-4個ずつ追加

### フェーズ3: 高度なバリアント
複雑な条件や複合効果を持つバリアント

---

## 必要な型・システム拡張

### 新しい効果タイプ
```typescript
type SpecialEffectType =
  | 'extra_damage'      // 既存
  | 'debuff'            // 既存
  | 'drain'             // 既存
  | 'buff'              // 既存
  | 'poison'            // 新規: 持続ダメージ
  | 'regen'             // 新規: 持続回復
  | 'damage_reduction'  // 新規: 被ダメ軽減
  | 'doom'              // 新規: 時限死
  | 'stun';             // 新規: 行動不能
```

### BattleStateへの追加
```typescript
interface BattleState {
  // 既存フィールド...

  // 新規追加
  variantUsageCount: Record<ActionVariant, number>; // 使用回数カウント
  hpHistory: { player: number; enemy: number }[];   // HP履歴（直前1ターン）
  fieldEffects: FieldEffect[];                      // フィールド効果
}
```

### その他の拡張
- ダメージ計算に軽減率、キャップ値を追加
- ファン率消費機能
- コメント全消費機能
- スタン判定（行動スキップ）
