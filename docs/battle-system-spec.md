# 🎮 バトルシステム仕様書（Ver.2.0）

---

## 🧩 基本概要

- コマンド選択型・ターン制バトル。
- 各ターンで以下の 3 択から行動を選択する。
  - **アタック (Attack)**
  - **アピール (Appeal)**
  - **ガード (Guard)**
- 三すくみ構造:
  - アタック ＞ アピール
  - アピール ＞ ガード
  - ガード ＞ アタック

### 勝敗結果

| 結果 | 効果 |
|------|------|
| 勝利 | 技発動 + ファン獲得 + アンチ軽減 |
| 引き分け | ファンの多い方が有利 |
| 敗北 | 被弾 + アンチ上昇 |
| **相打ち（NEW）** | 同じターンに両者HP 0以下で引き分け |

---

## ⚔️ 技の種類と性能

| 技名 | 勝利対象 | 技倍率 | ダメージ特性 | ファン変動 | アンチ変動 | 特徴・バランス意図 |
|------|----------|--------|--------------|------------|------------|----------------------|
| アタック (Attack) | アピール | ×1.2 | 通常攻撃 (高火力) | ±0% | +5 | 攻撃の主軸。連発するとアンチが上昇。 |
| アピール (Appeal) | ガード | ×0.0 | ダメージなし | +10% | −15 | 選択するだけで人気を回復（アンチ減）。勝利すればファンを大幅に獲得。 |
| ガード (Guard) | アタック | ×0.0 | 被ダメージ 80% カット (1/5) | +3% | −5 | 選択するだけで人気を回復（アンチ減）。勝利すれば防御しながらファンも獲得。 |

### アタック (Attack)

- 高火力の主攻撃手段。
- 三すくみでアピールに勝利。
- ファン補正が高いほど威力が上昇。
- 連発しすぎるとアンチが蓄積 (+5)。
- 観客の支持を得られなければ炎上リスク。

### アピール (Appeal)

- ファンを増やす行動で、ダメージは発生しない。
- 選択時にアンチ −15、三すくみで勝利時にファン +10%。
- ファン増加が次ターン以降の火力上昇につながる。
- 観客指示「アピールして！」で最大効果を発揮。

### ガード (Guard)

- 防御行動でアタックに強い。
- 被ダメージを 80% カット (実質 1/5)。
- 選択時にアンチ −5、三すくみで勝利時にファン +3%と冷静な対応が評価される。
- 守りながら魅せることで選択価値を確保。

---

## 🧠 ターン進行フロー

1. **観客の指示発表（3つ同時表示）**
   - 3つの観客指示がランダムに生成される
   - すべての指示が計算に反映される
2. プレイヤーと敵の行動選択
3. 勝敗判定 (三すくみロジック)
4. **アンチゲージ変動 (プレイヤーのみ、3つの指示すべてを判定)**
5. ダメージ計算と HP 更新
6. **ファン変動処理（3つの指示すべてを判定）**
7. アンチゲージ判定（Lv に応じてペナルティ適用）
8. 次ターン移行

---

## 🎤 オーディエンスシンクシステム (Audience Sync)

### 観客構成

- 🟥 相手のファン (Enemy Fans)
- 🟨 どっちつかずのファン (Neutral Fans)
- 🟩 自分のファン (Your Fans)

初期構成: 相手 20% / どっちつかず 70% / 自分 10%

### ダメージ計算式

```
最終ダメージ = 基礎火力 × 技倍率 × ファン補正 × アンチ補正 × ガード軽減
```

| ファン率 | 火力補正 |
|----------|----------|
| 0〜20% | ×1.0 |
| 21〜50% | ×1.2 |
| 51〜80% | ×1.5 |
| 81〜100% | ×2.0 |

### ファン変動式（更新）

```
Δ自分ファン = (勝敗補正 + 技成功補正 + 指示補正×3) × (1 - アンチペナルティ)
```

**重要な変更点:**
- **3つの観客指示すべてが計算に反映される**
- 各指示に従った/破ったかで個別に判定され、合計される

### ファン獲得元の変更（Ver.2.0）

**旧仕様:**
- ファン増加時: 中立ファンからのみ獲得（最低10%リザーブ）
- ファン減少時: 自分のファンが中立に戻る

**新仕様:**
- **ファン増加時: 中立ファンと敵ファンから半分ずつ奪う**
  - まず中立ファンから半分を獲得
  - 中立が不足している場合は、敵ファンから多く奪う
  - 中立が0の場合は、敵ファンから全額奪う
- **ファン減少時: 変更なし（自分のファンが中立に戻る）**

**例:**
- ファン+10%獲得時: 中立5% + 敵ファン5%
- 中立が2%しかない場合: 中立2% + 敵ファン8%
- 中立が0の場合: 敵ファン10%

| 種類 | 条件 | 変化量 | 備考 |
|------|------|---------|------|
| 勝敗補正 | 勝利 | +10% | 中立と敵ファンから半分ずつ |
| 勝敗補正 | 引き分け勝利 | +5% | 小幅増加 |
| 勝敗補正 | 敗北 | −5% | 自分 → どっちつかず |
| 指示補正 | **指示1つに従う** | **+5%** | どっちつかず → 自分 |
| 指示補正 | **指示1つに反する** | **−5%** | 自分 → どっちつかず |
| 技成功補正 | アピール成功 | +10% | 追加ボーナス |
| 技成功補正 | ガード成功 | +3% | 追加ボーナス |
| アンチ補正 | Lv1 | ×0.8（-20%） | ファン獲得が減少 |
| アンチ補正 | Lv2 | ×0.6（-40%） | ファン獲得が大幅減少 |
| アンチ補正 | Lv3 | ×0.4（-60%） | ファン獲得が激減 |

**計算例（3つの指示すべてに従った場合）:**
```
基礎変動 = 勝利(+10%) + アピール成功(+10%) + 指示×3(+5%×3)
         = +35%
アンチLv0の場合: +35% × (1 - 0) = +35%
アンチLv3の場合: +35% × (1 - 0.6) = +14%
```

---

## 👂 観客の指示システム (Audience Command)

### 指示の仕様（Ver.2.0）

- **各ターンで3つの観客指示が同時に表示される**
- **すべての指示が個別に判定され、効果が合算される**
- 3つすべてに従えば最大+15%、すべて破れば最大-15%

### 指示例と効果（1つあたり）

| 指示 | 成功時効果 | 失敗時効果 |
|------|------------|------------|
| 攻撃しろ！ | アタック選択でファン +5% | アピール・ガード選択でアンチ +10 |
| アピールして！ | アピール選択でファン +5% | 他行動でアンチ +10 |
| ガードするな！ | ガード以外でファン +5% | ガード選択でアンチ +15 |

**最悪のケース例:**
- 3つすべてが「攻撃しろ！」でガードを選択
- ファン: -15%（-5%×3）
- アンチ: +30（+10×3）

**最善のケース例:**
- 3つすべてが「アピールして！」でアピールを選択
- ファン: +10%（勝利） + +10%（アピール成功） + +15%（指示×3） = +35%
- アンチ: -15（アピール成功）

### 指示出現確率

| 指示タイプ | 確率 |
|------------|------|
| 攻撃しろ！ | 40% |
| アピールして！ | 30% |
| ガードするな！ | 30% |

---

## 😈 アンチゲージシステム (Anti Gauge)

- プレイヤー専用ゲージ。
- 観客の期待を裏切る行為で上昇。
- 高まるほど人気が低下し、最悪ブーイングが発生。

### アンチゲージ変動

**行動による変動:**

| 行動 | 変動量 | 備考 |
|:---|:---|:---|
| アタックで勝つ | +5 | 勝利時のみ |
| アピール選択 | -15 | 勝敗問わず |
| ガード選択 | -5 | 勝敗問わず |

**観客指示違反ペナルティ（3つの指示それぞれで判定）:**

| 違反した指示 | 変動量（1つあたり） |
|-------------|------------------|
| 「攻撃しろ！」を無視 | +10 |
| 「アピールして！」を無視 | +10 |
| 「ガードするな！」に従わずガード | +15 |

**計算例:**
- 3つの「攻撃しろ！」指示を無視してガード + ガードで勝つ
- アンチ変動: +10×3（違反） -5（ガード成功） = +25

### アンチレベル

| Lv | 範囲 | ファン獲得補正 | 火力補正 | 状態演出 |
|----|------|-----------------|-------------|--------------|
| Lv0 | 0〜29 | 100%（ペナルティなし） | 100% | 通常状態 |
| Lv1 | 30〜59 | 80%（−20%） | 90%（−10%） | 観客が冷め始める |
| Lv2 | 60〜89 | 60%（−40%） | 75%（−25%） | 明確なブーイング |
| Lv3 | 90〜100 | 40%（−60%） | 60%（−40%） | 炎上状態・大幅な弱体化 |

- Lv が上がるほどファン獲得量と与ダメージが大きく減少する。
- Lv3（炎上状態）でも行動制限はないが、ファン・火力のペナルティが最も重い。

---

## ⚖️ バトル数値目安

| 項目 | 値 | 備考 |
|------|------|------|
| HP | 1000 | 双方同一 |
| 基礎火力 | 100 | 計算基準値 |
| ファン変動単位 | 5% | 内部的には 0.05 |
| アンチ変動単位 | 5〜15 | 条件による |
| **最大ファン変動** | **±35%** | 勝利+アピール成功+指示×3 |
| **最大アンチ変動** | **+30/-15** | 指示×3違反 / アピール成功 |
| 平均ターン数 | 約 5〜8 | 戦略次第で変動 |
| 勝利条件 | 相手 HP 0 または引き分け | HP 0のみ（ファン条件は未実装） |

---

## 💬 状態まとめ

| 状態 | ファン獲得補正 | 火力補正 | 自動行動 | 備考 |
|------|----------------|----------|----------|------|
| 通常 (Lv0) | 100% | ×1.0 | なし | 安定状態 |
| 冷淡期 (Lv1) | 80%（−20%） | ×0.9 | なし | やや不利 |
| ブーイング期 (Lv2) | 60%（−40%） | ×0.75 | なし | 明確な不利 |
| 炎上期 (Lv3) | 40%（−60%） | ×0.6 | なし | 大幅な弱体化 |

---

## 🎯 デザイン上の狙い（Ver.2.0更新）

- **人気と火力を連動させ、観客との心理戦を重視。**
- **3つの観客指示システムで、より戦略的な判断を要求。**
  - すべて従う: 大きなボーナス（+15%ファン）
  - 一部従う: バランス型
  - すべて無視: 大きなリスク（-15%ファン、+30アンチ）
- **相手のファンを直接奪う仕組みで、より競争的なバトルに。**
- アピールは攻めへの布石、ガードは演出として機能。
- 攻め・守り・魅せが三すくみで成立。
- アンチゲージでリスク管理を導入し、単調なプレイを防止。

---

## 🧩 チートシート (開発者用)

| カテゴリ | 推奨範囲 | 現在値 |
|----------|----------|--------|
| ダメージ倍率 | 0.5〜2.0 | 1.2 (攻撃) |
| ファン変動 | ±3〜35% | ±5〜35% |
| アンチ変動 | ±5〜30 | +5〜+30 / -5〜-15 |
| アンチ閾値 | 30 / 60 / 90 | 30 / 60 / 90 |
| 戦闘ターン数 | 5〜8 想定 | 戦略次第 |
| 観客指示数 | 3つ同時 | 3つ |

---

## 📝 Ver.2.0 変更履歴

### 主要変更点

1. **観客指示システムの拡張**
   - 1つ → 3つの指示に拡張
   - すべての指示が個別に計算される
   - 最大変動量が大幅に増加（±15%ファン、±30アンチ）

2. **ファン獲得ロジックの変更**
   - 中立ファンのみ → 中立と敵ファンから半分ずつ奪う
   - 中立ファンリザーブ（10%）を削除
   - より攻撃的でダイナミックな観客争奪戦に

3. **引き分け判定の追加**
   - 同じターンに両者HP 0以下で引き分け
   - 相打ちの実装

4. **UI/UX改善**
   - リザルト画面にトップに戻るボタンを追加
   - 再戦ボタンのデザイン改善
   - ステータス更新タイミングの最適化（ショーダウン演出時）

### 実装済み機能

- ✅ 3つの観客指示システム
- ✅ 複数指示に対するファン/アンチゲージ計算
- ✅ 敵ファンを直接奪う仕組み
- ✅ 引き分け判定
- ✅ ショーダウン演出とステータス更新の同期

### 未実装機能

- ❌ ファン率80%以上での勝利条件
- ❌ 敵AI の高度化（現在はランダム選択）
- ❌ スキルやアビリティシステム
- ❌ 複数の敵キャラクター

---
