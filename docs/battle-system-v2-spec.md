# バトルシステム v2 仕様書

## 概要

感情ベースの4すくみバトルシステム。v1の3すくみから大幅に改変。

---

## 4すくみシステム

### 4つの感情アクション

1. **Rage（激怒）**
2. **Terror（恐怖）**
3. **Grief（悲嘆）**
4. **Ecstasy（恍惚）**

### 相性関係

```
Rage（激怒） > Terror（恐怖） > Grief（悲嘆） > Ecstasy（恍惚） > Rage
```

- **Rage > Terror**: 激怒が恐怖を圧倒する
- **Terror > Grief**: 恐怖が悲嘆を麻痺させる
- **Grief > Ecstasy**: 悲嘆が恍惚を現実に引き戻す
- **Ecstasy > Rage**: 至福が怒りを溶かす

---

## 各アクションの特徴

**基本構造**: 全てのアクションが「攻撃 + 特殊効果」の形式

### Rage（激怒）- 赤
- **UI表記**: Rage
- **攻撃ダメージ**: 基本攻撃力 × ファン率補正 × コメント補正 × 相性補正
- **特殊効果**: 追加攻撃
  - 激情のまま連続攻撃を繰り出す
  - ダメージの追加量: TBD（基本ダメージの50%？）

### Terror（恐怖）- 緑
- **UI表記**: Terror
- **攻撃ダメージ**: 基本攻撃力 × ファン率補正 × コメント補正 × 相性補正
- **特殊効果**: デバフ
  - 恐怖で相手を委縮させる
  - 効果: 相手の攻撃力を一時的に低下（TBD: 1ターン？数ターン？）
  - デバフ量: TBD（-20%？）

### Grief（悲嘆）- 青
- **UI表記**: Grief
- **攻撃ダメージ**: 基本攻撃力 × ファン率補正 × コメント補正 × 相性補正
- **特殊効果**: HP吸収（ドレイン）
  - 悲しみの重さで相手のエネルギーを吸い取る
  - 回復量: 与えたダメージの一部（TBD: 30%？50%？）

### Ecstasy（恍惚）- 黄
- **UI表記**: Ecstasy
- **攻撃ダメージ**: 基本攻撃力 × ファン率補正 × コメント補正 × 相性補正
- **特殊効果**: バフ（自己強化）
  - 至福の高揚感で能力アップ
  - 効果: 自分の攻撃力を一時的に上昇（TBD: 1ターン？数ターン？）
  - バフ量: TBD（+30%？）

#### ダメージ計算式（仮）

```
基本攻撃力: 100（仮）
ファン率補正: 1.0 + (ファン率 × 1.0)  // ファン率100%で2.0倍
コメント補正: 1.0 + (消費コメント数 × 0.2)  // 1コメントにつき+20%
相性補正:
  - 有利: 1.5倍
  - 互角: 1.0倍
  - 不利: 0.7倍
```

※ 数値は仮設定。バランス調整時に変更予定

---

## 新規追加要素

### 1. コメントシステム

配信画面風UIでコメントが流れ、攻撃の威力に影響を与える。

#### 基本仕様
- **コメント追加**: 毎ターン3個ずつ追加
- **最大保持数**: 10件まで
- **コメント属性**: 各コメントにRage/Terror/Grief/Ecstasyのいずれかの属性が付与される
- **属性の割り振り**: ランダム（TBD: 確率の偏りなど）

#### コメント消費
- プレイヤーが攻撃を選択すると、その属性と一致するコメントが全て消費される
- 消費されたコメント数が攻撃の火力やファン数に影響

#### 戦略要素
- 選択されなかった属性のコメントが溜まっていく
- どの属性を選ぶかでダメージとファン獲得が変化
- コメントが10件に達すると古いものから削除される

### 2. 配信画面風UI

#### レイアウト
- 配信者視点のUI
- コメント欄が見える配信画面をイメージ
- 4つの属性アイコン表示
- TBD（詳細デザイン）

### 3. キャラクター会話システム

ノベルゲーム風のテキストボックスを配置し、バトル中にキャラクター間の会話を表示。

#### 基本仕様
- ノベルゲーム風のテキストボックス
- プレイヤーキャラと敵キャラの会話
- バトル進行に応じて会話が発生
- TBD（会話のトリガータイミング、会話内容の管理方法）

#### 想定される会話タイミング
- バトル開始時
- ターン開始/終了時
- 特定の条件達成時（HP残り少ない、ファン率高い、など）
- バトル終了時

#### UI配置
- テキストボックスの位置: TBD
- キャラクター立ち絵: TBD（表示するか未定）
- テキスト送り: TBD（自動 or クリック）

---

## v1から削除/変更される要素

### 削除される要素
- **3すくみシステム** → 4すくみに変更
- **アタック/アピール/ガードの概念** → 感情ベースの4アクションに変更
- **ダメージなしアクション（アピール）** → 全てのアクションが攻撃を持つ
- **防御アクション（ガード）** → 廃止
- **アンチゲージシステム** → 完全削除
- **観客指示システム（3つの指示）** → コメントシステムに置き換え

### 変更される要素
- **アクション数**: 3 → 4
- **アクションの性質**: 役割分担型 → 全て攻撃+特殊効果型
- **ファン率システム**: 継続するが計算方法とUIを改修

---

## v1から継続する要素

### 継続が確定している要素
- **バトルシステムの根本構造**
  - ターン制バトル
  - HP制
  - プレイヤー vs 敵の1vs1形式
- **ファン率システム**
  - ファン率が火力に影響する仕組み
  - 計算方法とUIは改修予定
- **観客構成の概念**
  - 敵ファン/中立/プレイヤーファンの割合
  - ファンの奪い合い
  - ※ 表示方法やUIは変更予定

---

## その他の仕様

- TBD

---

## 実装メモ

- 4すくみの判定ロジックが必要
- UIは完全刷新予定

### 色設定
- **Rage**: 赤 (#赤系カラーコード)
- **Terror**: 緑 (#緑系カラーコード)
- **Grief**: 青 (#青系カラーコード)
- **Ecstasy**: 黄 (#黄系カラーコード)

### 特殊効果の実装
- Rage: 追加攻撃（連続ダメージ）
- Terror: デバフ（攻撃力低下）
- Grief: HP吸収（ドレイン）
- Ecstasy: バフ（攻撃力上昇）

---

## 更新履歴

- 2025-10-29: 初版作成、4すくみの相性関係を決定
- 2025-10-29: 全アクションが「攻撃+特殊効果」形式であることを決定
- 2025-10-29: コメントシステムと配信画面風UIを追加（毎ターン3個追加、最大10件）
- 2025-10-29: 仮ダメージ計算式を設定（ファン率・コメント・相性補正）
- 2025-10-29: キャラクター会話システムを追加（ノベルゲーム風テキストボックス）
- 2025-10-29: v1からの削除/変更要素を明確化（アンチゲージ削除、観客指示→コメント）
- 2025-10-29: 特殊効果の種類を決定（追加攻撃/回復/バフ/デバフ）
- 2025-10-29: 各感情に特殊効果を割り当て（Rage=追加攻撃、Terror=デバフ、Grief=回復、Ecstasy=バフ）
- 2025-10-29: UI表記を英語に決定、色設定を決定（赤/緑/青/黄）
